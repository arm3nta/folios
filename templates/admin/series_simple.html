{% extends 'base.html' %}

{% block content %}
<div class="row g-3 mb-4">
  <div class="col-md-12">
    <div class="card"><div class="card-body">
      <h4>Series</h4>
      
      <!-- Filtros -->
      <div class="row mb-3">
        <div class="col-md-6">
          <div class="input-group">
            <input type="text" name="q" class="form-control" placeholder="Buscar serie..." value="{{ query or '' }}">
          </div>
        </div>
        <div class="col-md-3">
          <div class="input-group">
            <select name="plant_id" class="form-control" onchange="this.form.submit()">
              <option value="">Todos los planteles</option>
              {% for plant in plants %}
                <option value="{{ plant.id }}" {% if plant_id|string == plant.id|string %}selected{% endif %}>{{ plant.name }} ({{ plant.cct }})</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="col-md-3">
          <button type="submit" class="btn btn-primary">Filtrar</button>
        </div>
      </div>

      <!-- Lista de series -->
      <div class="table-responsive">
        <table class="table table-striped table-sm">
          <thead>
            <tr>
              <th>Serie</th>
              <th>Total</th>
              <th>Disponibles</th>
              <th>Asignados</th>
              <th>Próximo folio</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for s in series %}
            <tr>
              <td>{{ s.name }}</td>
              <td>{{ s.total_added or 0 }}</td>
              <td>{{ s.remaining or 0 }}</td>
              <td>{{ (s.total_added or 0) - (s.remaining or 0) }}</td>
              <td>{{ s.next_folio or 1 }}</td>
              <td>
                <a href="{{ url_for('admin_add_folios', series_id=s.id) }}" class="btn btn-sm btn-outline-primary">Asignar Folios</a>
                <a href="{{ url_for('admin_series') }}" class="btn btn-sm btn-outline-secondary">Editar</a>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="6" class="text-center text-muted">No se encontraron series</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Botón Nueva Serie -->
      <div class="mt-3">
        <a href="{{ url_for('admin_series') }}" class="btn btn-success">Nueva Serie</a>
      </div>
    </div></div>
  </div>
</div>

<style>
.table th {
  background-color: #f8f9fa;
  font-weight: bold;
  border: 1px solid #dee2e6;
}
.table td {
  vertical-align: middle;
}
</style>
{% endblock %}
